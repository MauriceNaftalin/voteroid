<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Phone Client</title>
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@7.0.0/bundles/stomp.umd.min.js"></script>
    <script src="/phoneClientStompManager.js"></script>
</head>
<body>
<div>
    Server:<br>
    <input type="radio" name="endpointOptions" value="localhost"> localhost<br>
    <input type="radio" name="endpointOptions" value="AWS"> AWS<br>
</div>
<label style="width: 100px;" id="question">No question</label>
<form class='voteButtonForm' action="" method="GET">
    <input type="hidden" name="answer" value="1">
    <input type="submit" value="Answer: 1">
</form>
<form class='voteButtonForm' action="" method="GET">
    <input type="hidden" name="answer" value="2">
    <input type="submit" value="Answer: 2">
</form>
<form class='voteButtonForm' action="" method="GET">
    <input type="hidden" name="answer" value="3">
    <input type="submit" value="Answer: 3">
</form>
<script>
    function setEndpointInButtonForms() {
        var forms = document.getElementsByClassName('voteButtonForm');
        var selectedOption = document.querySelector('input[name="endpointOptions"]:checked');

        if (selectedOption) {
            for (const form of forms) {
                if (selectedOption.value === 'localhost') {
                    form.action = 'http://localhost:8080/qwer/vote';
                } else if (selectedOption.value === 'AWS') {
                    form.action = 'http://voteroid-env.eba-mtfwaqgp.us-east-1.elasticbeanstalk.com:80/vote';
                }
            }
        }
    }

    function setCurrentSlide(currentSlide) {
        var forms = document.getElementsByClassName('voteButtonForm');
        for (const form of forms) {
            form.action = 'http://localhost:8080/' + currentSlide + '/vote';
        }
        document.getElementById('question').textContent = currentSlide;
    }

    // Add event listeners to the radio buttons
    var radioButtons = document.querySelectorAll('input[name="endpointOptions"]');
    radioButtons.forEach(function(radio) {
        radio.addEventListener('change', setEndpointInButtonForms);
    });

    connectStompClient();

    fetch('http://' + window.location.host + '/getCurrentSlide', {
        method: 'GET',
        headers: {'Content-Type': 'application/json'}
    })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => setCurrentSlide(data.currentSlide))
        .catch(error => {
            console.error('Fetch error:', error);
        });

</script>
</body>
</html>