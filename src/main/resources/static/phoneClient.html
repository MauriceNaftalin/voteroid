<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Phone Client</title>
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@7.0.0/bundles/stomp.umd.min.js"></script>
    <script src="/phoneClientStompManager.js"></script>
</head>
<body>
<label style="width: 100px;" id="question">No question</label>
<br/>
<button class="answerButton">answerButton1</button>
<button class="answerButton">answerButton2</button>
<button class="answerButton">answerButton3</button>
<script>
    const answerButtons = document.getElementsByClassName('answerButton');
    var currentQuestion;

    connectStompClient();

    // TODO replace this with getting the current question name, then making the URI of the slide from it
    // and getting that.
    fetch('http://' + window.location.host + '/current-question-name', {
        method: 'GET',
        headers: {'Content-Type': 'text/plain'}
    })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.text();
        })
        .then(data => setCurrentQuestion(data))
        .catch(error => {
            console.error('Fetch error:', error);
        });

    for (let answerIndex = 0; answerIndex < answerButtons.length; answerIndex++) {
        setAnswerButtonListener(answerButtons[answerIndex], answerIndex);
    }

    function setAnswerButtonListener(button, answerIndex) {
        button.addEventListener('click', function () {
            const requestOptions = {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
            };
            const voteUri = `http://localhost:8080/${currentQuestion}/answers/${answerIndex + 1}/vote`;
            fetch(voteUri, requestOptions)
                .then(response => {if (!response.ok) throw new Error('Network error');
                    console.log(`Vote registered: /${currentQuestion}/answers/${answerIndex + 1}/vote`);
                })
                .catch(error => {
                    console.error('Fetch operation error:', error);
                });
        })
    }

    /* called at initialisation of the client, and when the slide changes */
    function setCurrentQuestion(currentSlide) {
        currentQuestion = currentSlide;
        document.getElementById('question').textContent = currentSlide;
    }

</script>
</body>
</html>