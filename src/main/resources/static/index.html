<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@7.0.0/bundles/stomp.umd.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="/iframeStompManager.js"></script>
    <script src="/d3manipulation.js"></script>
</head>
<body>
<svg id="svg"></svg>
<div>
    <button class="answerButton">answerButton1</button>
    <button class="answerButton">answerButton2</button>
    <button class="answerButton">answerButton3</button>
</div>
<label style="width: 100px;" id="questionNameLabel">No question</label>
<!--https://stackoverflow.com/a/15069289-->
<script>
    connectStompClient();

    document.addEventListener('DOMContentLoaded', function() {
        var svgElement = document.getElementById("svg");
        const params = new URLSearchParams(window.location.search);
        if (params.size === 0) {
            // phone client
            var chartHeight = window.innerHeight - 75;
            var chartWidth = window.innerWidth - 20;
            svgElement.setAttribute("width", chartWidth);
            svgElement.setAttribute("height", chartHeight);
            setUpSvg(chartWidth, chartHeight);
            getCurrentQuestionAndSetButtonListeners();
        } else {
            // presentation iframe
            const question = params.get('question');
            showQuestionName(question);
            svgElement.setAttribute("width", 250);
            svgElement.setAttribute("height", 250);
            setUpSvg(250,250);
        }
    });

    document.addEventListener("DOMContentLoaded", function() {
        const params = new URLSearchParams(window.location.search);
        const questionName = params.get('question');

        fetch(`http://${window.location.host}/slides/${questionName}`, {
            method: 'GET',
            headers: {'Content-Type': 'application/json'}
        })
            .then(response => {if (!response.ok) throw new Error('Network response was not ok');return response.json();})
            .then(data => {
                setButtonLabels(data.answers);
            })
            .catch(error => console.error('Fetch error:', error));
    })

    function setButtonLabels(answers) {
        const answerButtons = document.getElementsByClassName('answerButton');
        const answerTexts = answers.map(obj => obj.text);
        for (let answerIndex = 0; answerIndex < answerButtons.length; answerIndex++) {
            answerButtons[answerIndex].textContent = answerTexts[answerIndex];
            console.log(answerTexts);
        }
    }
</script>
</body>
</html>
